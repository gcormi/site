<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Escape Game : Récupération d'Eau de Pluie</title>
    <style>
        /* Styles Généraux */
        body {
            font-family: Arial, sans-serif;
            background: url('https://images.unsplash.com/photo-1438449805896-28a666819a20?q=80&w=2340&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') no-repeat center/cover;
            color: #f0f0f0;
            text-align: center;
            padding: 20px;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Blocs de Mission */
        .block {
            display: none;
            background: rgba(144, 238, 144, 0.85); /* Vert clair */
            border: 3px solid #FF69B4; /* Rose vif */
            padding: 20px;
            max-width: 600px;
            border-radius: 10px;
            box-shadow: 0 0 15px #98FB98; /* Vert pâle */
            position: absolute;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            z-index: 1;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #f0f8ff;
        }

        .block.active {
            display: block;
            opacity: 1;
        }

        /* Fenêtres d'Aide */
        .course-window {
            display: none;
            background: rgba(255, 182, 193, 0.7); /* Rose */
            border: 2px solid #90EE90; /* Vert clair */
            padding: 15px;
            max-width: 300px;
            border-radius: 8px;
            position: absolute;
            color: #333; /* Gris foncé */
            font-size: 14px;
            z-index: 2;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.1s linear;
        }

        .course-window.active {
            display: block;
            opacity: 1;
        }

        h1, h2 {
            color: #FF69B4; /* Rose vif */
            text-shadow: 0 0 5px #98FB98; /* Vert pâle */
        }

        button {
            background-color: #98FB98; /* Vert pâle */
            border: none;
            padding: 10px 20px;
            color: #333; /* Gris foncé */
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            margin: 5px;
            transition: background 0.3s;
        }

        button:hover {
            background-color: #FF69B4; /* Rose vif */
        }

        input, select {
            padding: 8px;
            margin: 10px;
            border-radius: 5px;
            border: 1px solid #98FB98; /* Vert pâle */
            background: #fff;
            color: #333; /* Gris foncé */
            font-size: 14px;
        }

        .resultat {
            color: #FF69B4; /* Rose vif */
            font-weight: bold;
            margin-top: 10px;
        }

        .victory {
            animation: pulse 1s infinite;
            font-size: 28px;
            color: #FF69B4;
        }

        #timer {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 14px;
            color: #98FB98; /* Vert pâle */
        }

        #musicControl {
            position: fixed;
            top: 40px;
            right: 10px;
            z-index: 2;
        }

        .match-container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .match-item {
            width: 45%;
            margin: 5px;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
         /* Style pour la lettre collectée */
        .lettre-collectee {
            color: #ffff00; /* jaune*/
            font-weight: bold;
            font-size: 1.2em;
        }

        /* Style pour le mot magique */
        #magicWord {
            font-size: 36px;
            color: #ffff00; /* jaune*/
            text-shadow: 2px 2px 4px #000000;
            animation: pulse 1.5s infinite;
        }
        /* Modification pour ajuster la largeur des select */
        .match-item select {
            width: 100%;
            box-sizing: border-box;
        }

        /* Augmentation de la largeur du bloc pour accommoder les select */
        .block {
            max-width: 700px;
        }
    </style>
</head>
<body>
    <!-- Musique de fond -->
    <audio id="backgroundMusic" loop>
        <source src="https://nuage03.apps.education.fr/index.php/s/rfAms6FDNH2ojXM/download/Dancing%20with%20Demons.m4a" type="audio/mp4">
        Votre navigateur ne supporte pas l'audio.
    </audio>
    <button id="musicControl" onclick="toggleMusic()">Activer le son</button>
    <div id="timer">Temps : 00:00</div>

    <!-- Introduction -->
    <div id="intro" class="block active">
        <h1>Sauvez la Planète une Goutte à la Fois !</h1>
        <p>"Apprenti éco-héros, la Terre a soif ! Découvre les secrets de la récupération d'eau de pluie, résous 20 défis et débloque une phrase pour l'avenir ! Chaque bonne réponse te donne une lettre. Au travail !"</p>

        <!-- Règles du jeu ajoutées ici -->
        <h2>Règles du jeu :</h2>
        <ul>
            <li>Entre ton identifiant Léia pour commencer.</li>
            <li>Réponds aux 20 missions pour collecter des lettres.</li>
            <li>Tu as deux essais par mission.</li>
            <li>Avec les lettres collectées, complète la phrase mystère.</li>
            <li>Si tu réussis, le mot magique s'affichera !</li>
        </ul>
        <input type="text" id="agentIdLeia" placeholder="Ton identifiant">
        <button onclick="startGame()">Démarrer</button>
    </div>

    <!-- Mission 1: QCM -->
    <div id="mission1" class="block">
        <h2>Mission 1 : Introduction</h2>
        <p id="m1text">"Dans un système de récupération d'eau de pluie, où commence le voyage de l'eau ?"</p>
        <select id="choix1">
            <option value="">Choisis...</option>
            <option value="B">Sur le toit.</option>
            <option value="A">Dans la cuve de stockage.</option>
            <option value="C">Dans les nuages.</option>
        </select>
        <button onclick="verifierMission1()">Valider</button>
        <button onclick="passer(2)">Passer</button>
        <p id="resultat1" class="resultat"></p>
    </div>
    <div id="course1" class="course-window">
        <p>C'est là que la pluie arrive en premier !</p>
    </div>

    <!-- Mission 2: Question ouverte -->
    <div id="mission2" class="block">
        <h2>Mission 2 : Collecte</h2>
        <p id="m2text">"Comment s'appellent les "canaux" qui collectent l'eau sur un toit ? (1 mot)"</p>
        <input type="text" id="reponse2" placeholder="Entre ta réponse">
        <button onclick="verifierMission2()">Valider</button>
        <button onclick="passer(3)">Passer</button>
        <p id="resultat2" class="resultat"></p>
    </div>
    <div id="course2" class="course-window">
        <p>Pense aux bords du toit...</p>
    </div>

    <!-- Mission 3: Pendu -->
    <div id="mission3" class="block">
        <h2>Mission 3 : Collecte</h2>
        <p id="m3text">"Devine le mot : Action de diriger l'eau vers un endroit précis. (11 lettres)"</p>
        <p id="penduDisplay3"></p>
        <input type="text" id="lettre3" maxlength="1" placeholder="Entre une lettre">
        <button onclick="jouerPendu3()">Essayer</button>
        <button onclick="passer(4)">Passer</button>
        <p id="resultat3" class="resultat">Essais restants : 6</p>
    </div>
    <div id="course3" class="course-window">
        <p>Ce n'est pas la laisser tomber n'importe où !</p>
    </div>

    <!-- Mission 4: QCM -->
    <div id="mission4" class="block">
        <h2>Mission 4 : Filtration</h2>
        <p id="m4text">"Quel est le rôle des filtres à mailles dans un système de récupération d'eau de pluie ?"</p>
        <select id="choix4">
            <option value="">Choisis...</option>
            <option value="B">Retenir les grosses impuretés.</option>
            <option value="A">Colorer l'eau en bleu.</option>
            <option value="C">Ajouter du sucre.</option>
        </select>
        <button onclick="verifierMission4()">Valider</button>
        <button onclick="passer(5)">Passer</button>
        <p id="resultat4" class="resultat"></p>
    </div>
    <div id="course4" class="course-window">
        <p>Ils agissent comme une passoire.</p>
    </div>

    <!-- Mission 5: Appariement -->
    <div id="mission5" class="block">
        <h2>Mission 5 : Filtration</h2>
        <p id="m5text">"Associe chaque filtre à ce qu'il élimine :"</p>
        <div class="match-container">
            <div class="match-item">
                <p>Filtre à mailles</p>
                <select id="match5_1">
                    <option value="">Choisis...</option>
                    <option value="B">Les grosses impuretés (feuilles, etc.)</option>
                    <option value="A">Les petites particules et les polluants chimiques</option>
                </select>
            </div>
            <div class="match-item">
                <p>Filtre à charbon actif</p>
                <select id="match5_2">
                    <option value="">Choisis...</option>
                    <option value="A">Les petites particules et les polluants chimiques</option>
                    <option value="B">Les grosses impuretés (feuilles, etc.)</option>
                </select>
            </div>
        </div>
        <button onclick="verifierMission5()">Valider</button>
        <button onclick="passer(6)">Passer</button>
        <p id="resultat5" class="resultat"></p>
    </div>
    <div id="course5" class="course-window">
        <p>Les deux travaillent ensemble pour une eau propre !</p>
    </div>

    <!-- Mission 6: Question ouverte -->
    <div id="mission6" class="block">
        <h2>Mission 6 : Filtration</h2>
        <p id="m6text">"De quoi sont faites les mailles d'un filtre ? (1 mots)"</p>
        <input type="text" id="reponse6" placeholder="Entre ta réponse">
        <button onclick="verifierMission6()">Valider</button>
        <button onclick="passer(7)">Passer</button>
        <p id="resultat6" class="resultat"></p>
    </div>
    <div id="course6" class="course-window">
        <p>Ce sont des matériaux solides et résistants.</p>
    </div>

    <!-- Mission 7: QCM -->
    <div id="mission7" class="block">
        <h2>Mission 7 : Stockage</h2>
        <p id="m7text">"Dans quoi stocke-t-on l'eau de pluie après la filtration ?"</p>
        <select id="choix7">
            <option value="">Choisis...</option>
            <option value="B">Dans une cuve.</option>
            <option value="A">Dans un nuage.</option>
            <option value="C">Dans une bouteille.</option>
        </select>
        <button onclick="verifierMission7()">Valider</button>
        <button onclick="passer(8)">Passer</button>
        <p id="resultat7" class="resultat"></p>
    </div>
    <div id="course7" class="course-window">
        <p>C'est comme un grand réservoir.</p>
    </div>

    <!-- Mission 8: Pendu -->
    <div id="mission8" class="block">
        <h2>Mission 8 : Stockage</h2>
        <p id="m8text">"Devine le mot : Cuve enterrée qui protège l'eau des variations de température (9 lettres)"</p>
        <p id="penduDisplay8"></p>
        <input type="text" id="lettre8" maxlength="1" placeholder="Entre une lettre">
        <button onclick="jouerPendu8()">Essayer</button>
        <button onclick="passer(9)">Passer</button>
        <p id="resultat8" class="resultat">Essais restants : 6</p>
    </div>
    <div id="course8" class="course-window">
        <p>Elle se cache sous la terre.</p>
    </div>

    <!-- Mission 9: Question Ouverte -->
    <div id="mission9" class="block">
        <h2>Mission 9 : Utilisations</h2>
        <p id="m9text">"Pour quelles tâches courantes, l'eau de pluie récupérée est-elle parfaite ? (arrosage, ...) (2 mots)"</p>
        <input type="text" id="reponse9" placeholder="Entre ta réponse">
        <button onclick="verifierMission9()">Valider</button>
        <button onclick="passer(10)">Passer</button>
        <p id="resultat9" class="resultat"></p>
    </div>
    <div id="course9" class="course-window">
        <p>Pense à la voiture, à la cour...</p>
    </div>

    <!-- Mission 10: QCM -->
    <div id="mission10" class="block">
        <h2>Mission 10 : Installation</h2>
        <p id="m10text">"Pour installer une cuve, quel aspect du sol faut-il prendre en compte ?"</p>
        <select id="choix10">
            <option value="">Choisis...</option>
            <option value="B">Sa stabilité.</option>
            <option value="A">Sa couleur.</option>
            <option value="C">Son odeur.</option>
        </select>
        <button onclick="verifierMission10()">Valider</button>
        <button onclick="passer(11)">Passer</button>
        <p id="resultat10" class="resultat"></p>
    </div>
    <div id="course10" class="course-window">
        <p>Il faut qu'elle puisse supporter le poids de la cuve pleine.</p>
    </div>

    <!-- Mission 11: Appariement -->
    <div id="mission11" class="block">
        <h2>Mission 11 : Installation</h2>
        <p id="m11text">"Associe chaque étape de l'installation à sa description :"</p>
        <div class="match-container">
            <div class="match-item">
                <p>Choix de l'emplacement</p>
                <select id="match11_1">
                    <option value="">Choisis...</option>
                    <option value="B">Choisir l'endroit idéal pour installer la cuve.</option>
                    <option value="A">Relier les gouttières au système de filtration à l'aide de tuyaux</option>
                    <option value="C">Placer la cuve sur une base stable.</option>
                </select>
            </div>
            <div class="match-item">
                <p>Connexion des gouttières</p>
                <select id="match11_2">
                    <option value="">Choisis...</option>
                   <option value="A">Relier les gouttières au système de filtration à l'aide de tuyaux</option>
                    <option value="B">Choisir l'endroit idéal pour installer la cuve.</option>
                    <option value="C">Placer la cuve sur une base stable.</option>
                </select>
            </div>
            <div class="match-item">
                <p>Installation de la cuve</p>
                <select id="match11_3">
                    <option value="">Choisis...</option>
                    <option value="C">Placer la cuve sur une base stable.</option>
                    <option value="A">Relier les gouttières au système de filtration à l'aide de tuyaux</option>
                    <option value="B">Choisir l'endroit idéal pour installer la cuve.</option>
                </select>
            </div>
        </div>
        <button onclick="verifierMission11()">Valider</button>
        <button onclick="passer(12)">Passer</button>
        <p id="resultat11" class="resultat"></p>
    </div>
    <div id="course11" class="course-window">
        <p>Chaque étape est importante pour que tout fonctionne bien !</p>
    </div>

    <!-- Mission 12: Pendu -->
    <div id="mission12" class="block">
        <h2>Mission 12 : Outils</h2>
        <p id="m12text">"Devine le mot : Outil de bricolage pour couper les tuyaux. (4 lettres)"</p>
        <p id="penduDisplay12"></p>
        <input type="text" id="lettre12" maxlength="1" placeholder="Entre une lettre">
        <button onclick="jouerPendu12()">Essayer</button>
        <button onclick="passer(13)">Passer</button>
        <p id="resultat12" class="resultat">Essais restants : 6</p>
    </div>
    <div id="course12" class="course-window">
        <p>Elle a des dents acérées !</p>
    </div>

    <!-- Mission 13: QCM -->
    <div id="mission13" class="block">
        <h2>Mission 13 : Entretien</h2>
        <p id="m13text">"À quelle fréquence faut-il nettoyer les filtres d'un système de récupération d'eau de pluie ?"</p>
        <select id="choix13">
            <option value="">Choisis...</option>
            <option value="B">Au moins une fois par mois.</option>
            <option value="A">Jamais.</option>
            <option value="C">Tous les ans.</option>
        </select>
        <button onclick="verifierMission13()">Valider</button>
        <button onclick="passer(14)">Passer</button>
        <p id="resultat13" class="resultat"></p>
    </div>
    <div id="course13" class="course-window">
        <p>Pour éviter qu'ils ne se bouchent !</p>
    </div>

    <!-- Mission 14: Question Ouverte -->
    <div id="mission14" class="block">
        <h2>Mission 14 : Energie</h2>
        <p id="m14text">"Quelle force naturelle permet à l'eau de couler des gouttières vers la cuve ? (1 mot)"</p>
        <input type="text" id="reponse14" placeholder="Entre ta réponse">
        <button onclick="verifierMission14()">Valider</button>
        <button onclick="passer(15)">Passer</button>
        <p id="resultat14" class="resultat"></p>
    </div>
    <div id="course14" class="course-window">
        <p>C'est ce qui nous maintient sur Terre !</p>
    </div>

    <!-- Mission 15: QCM -->
    <div id="mission15" class="block">
        <h2>Mission 15 : Energie</h2>
        <p id="m15text">"Quand utilise-t-on une pompe électrique dans un système de récupération d'eau de pluie ?"</p>
        <select id="choix15">
            <option value="">Choisis...</option>
            <option value="B">Pour distribuer l'eau si elle doit être acheminée vers un endroit situé plus haut ou plus loin.</option>
            <option value="A">Pour faire remonter l'eau vers les nuages.</option>
            <option value="C">Pour faire des vagues dans la cuve.</option>
        </select>
        <button onclick="verifierMission15()">Valider</button>
        <button onclick="passer(16)">Passer</button>
        <p id="resultat15" class="resultat"></p>
    </div>
    <div id="course15" class="course-window">
        <p>Quand la gravité ne suffit pas...</p>
    </div>

    <!-- Mission 16: Pendu -->
    <div id="mission16" class="block">
        <h2>Mission 16 : Materiaux</h2>
        <p id="m16text">"Devine le mot : Qualité d'une cuve qui résiste aux intempéries (8 lettres)"</p>
        <p id="penduDisplay16"></p>
        <input type="text" id="lettre16" maxlength="1" placeholder="Entre une lettre">
        <button onclick="jouerPendu16()">Essayer</button>
        <button onclick="passer(17)">Passer</button>
        <p id="resultat16" class="resultat">Essais restants : 6</p>
    </div>
    <div id="course16" class="course-window">
        <p>Elle doit durer longtemps !</p>
    </div>

    <!-- Mission 17: Appariement -->
    <div id="mission17" class="block">
        <h2>Mission 17 : Materiaux</h2>
        <p id="m17text">"Associe le matériau à son avantage :"</p>
        <div class="match-container">
            <div class="match-item">
                <p>Cuve en plastique</p>
                <select id="match17_1">
                    <option value="">Choisis...</option>
                    <option value="A">Moins chère, facile à installer</option>
                    <option value="B">Très durable et résistante aux intempéries</option>
                </select>
            </div>
            <div classclass="match-item">
                <p>Cuve en béton</p>
                <select id="match17_2">
                    <option value="">Choisis...</option>
                    <option value="B">Très durable et résistante aux intempéries</option>
                    <option value="A">Moins chère, facile à installer</option>
                </select>
            </div>
        </div>
        <button onclick="verifierMission17()">Valider</button>
        <button onclick="passer(18)">Passer</button>
        <p id="resultat17" class="resultat"></p>
    </div>
    <div id="course17" class="course-window">
        <p>Pense au prix et à la solidité.</p>
    </div>

    <!-- Mission 18: Qui suis-je? -->
    <div id="mission18" class="block">
        <h2>Mission 18 : Hydraulique</h2>
        <p id="m18text">"Quel terme désigne la quantité d'eau qui passe dans le systeme (1 mot)"</p>
        <input type="text" id="reponse18" placeholder="Entre ta réponse">
        <button onclick="verifierMission18()">Valider</button>
        <button onclick="passer(19)">Passer</button>
        <p id="resultat18" class="resultat"></p>
    </div>
    <div id="course18" class="course-window">
        <p>Ca se mesure en litres par minutes ou en mètres cubes par heure.</p>
    </div>

    <!-- Mission 19: QCM -->
    <div id="mission19" class="block">
        <h2>Mission 19 : Filtration</h2>
        <p id="m19text">"Quel filtre est à remplacer périodiquement ?"</p>
        <select id="choix19">
            <option value="">Choisis...</option>
            <option value="B">Filtre à charbon actif.</option>
            <option value="A">Filtre à mailles.</option>
            <option value="C">Les tuyaux en PVC.</option>
        </select>
        <button onclick="verifierMission19()">Valider</button>
        <button onclick="passer(20)">Passer</button>
        <p id="resultat19" class="resultat"></p>
    </div>
    <div id="course19" class="course-window">
        <p>Il s'use en absorbant les impuretés.</p>
    </div>

    <!-- Mission 20: Pendu -->
    <div id="mission20" class="block">
        <h2>Mission 20 : Conclusion</h2>
        <p id="m20text">"Devine le mot : Action de protéger nos ressources en eau (13 lettres)"</p>
        <p id="penduDisplay20"></p>
        <input type="text" id="lettre20" maxlength="1" placeholder="Entre une lettre">
        <button onclick="jouerPendu20()">Essayer</button>
        <button onclick="passer(21)">Passer</button>
        <p id="resultat20" class="resultat">Essais restants : 6</p>
    </div>
    <div id="course20" class="course-window">
        <p>Ne pas gaspiller.</p>
    </div>

    <!-- Victoire -->
    <div id="victoire" class="block">
        <h1 class="victory">Mission Accomplie !</h1>
        <p id="agentResult"></p>
        <p id="timeResult"></p>
        <p id="scoreResult"></p>
        <p id="messageResult"></p>
        <p id="parcoursResult"></p>
        <p id="magicWord" style="display: none;"></p>
        <p>Phrase avec tes lettres :</p>
        <p id="partial-phrase"></p>
        <p>Complète la phrase (5 mots) :</p>
        <input type="text" id="phraseInput" placeholder="24 lettres max">
        <button onclick="verifierPhrase()">Valider la phrase</button>
        <p id="phraseResult"></p>
    </div>

    <script>
        let agent = "Apprenti éco-héros";
        let startTime = 0;
        let timerInterval = null;
        let reussites = 0;
        let passees = [];
        let collectedLetters = new Array(20);
        const finalPhrase = "EAU DE PLUIE, OR BLEU DU FUTUR";
        const missionLetters = finalPhrase.split("");
        let angle = 0;
        let musicPlaying = false;
		let music = document.getElementById("backgroundMusic");
        let courseRotationInterval = null;
        let rotationSpeed = 0.002;

		 const motSecret = "PLU-876";
        /* Fonction pour démarrer le jeu */
                function startGame() {
            const idLeia = document.getElementById("agentIdLeia").value.trim();
            if (!idLeia) {
                alert("Entre ton identifiant !");
                return;
            }
            agent = `Apprenti éco-héros - ${idLeia}`;
            document.querySelectorAll("p[id^='m']").forEach(p => {
                p.innerHTML = p.innerHTML.replace("Apprenti éco-héros", agent);
            });
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
            randomizeCoursePositions();
             showBlock("mission1");
              requestAnimationFrame(animateCourseWindows);
        }
        /* Fonction pour mettre à jour le timer */
        function updateTimer() {
            const now = Date.now();
            const elapsed = Math.floor((now - startTime) / 1000);
            const minutes = String(Math.floor(elapsed / 60)).padStart(2, "0");
            const seconds = String(elapsed % 60).padStart(2, "0");
            document.getElementById("timer").textContent = `Temps : ${minutes}:${seconds}`;
        }

        function randomizeCoursePositions() {
            const courseWindows = document.querySelectorAll(".course-window");
            courseWindows.forEach((course, index) => {
                const initialAngle = (index * 2 * Math.PI) / courseWindows.length;
                const radius = 450;
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                const x = centerX + radius * Math.cos(initialAngle) - 200;
                const y = centerY + radius * Math.sin(initialAngle) - 50;
                course.style.left = `${x}px`;
                course.style.top = `${y}px`;
                course.dataset.angle = initialAngle;
            });
        }
      function afficherLettreGagnee(missionNumber) {
            const resultatElement = document.getElementById("resultat" + missionNumber);
                if (resultatElement) {
                resultatElement.innerHTML += `<span class='lettre-collectee'> Lettre collectée: ${missionLetters[missionNumber - 1]}</span>`
              }
         }

        function animateCourseWindows() {
            const courseWindows = document.querySelectorAll(".course-window.active");
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            const radius = 450;
            angle += 0.002;

            courseWindows.forEach(course => {
                let currentAngle = parseFloat(course.dataset.angle) + angle;
                const x = centerX + radius * Math.cos(currentAngle) - 200;
                const y = centerY + radius * Math.sin(currentAngle) - 50;
                course.style.left = `${x}px`;
                course.style.top = `${y}px`;
            });
            requestAnimationFrame(animateCourseWindows);
        }

        function showBlock(blockId) {
            document.querySelectorAll(".block").forEach(block => block.classList.remove("active"));
            document.querySelectorAll(".course-window").forEach(course => course.classList.remove("active"));
            const newBlock = document.getElementById(blockId);
            if (newBlock) {
                newBlock.classList.add("active");
                const courseId = blockId.replace("mission", "course");
                const courseWindow = document.getElementById(courseId);
                if (courseWindow) courseWindow.classList.add("active");
            }
        }

        function passer(next) {
            passees.push(next - 1);
            if (next <= 20) {
                showBlock(`mission${next}`);
            } else {
                showBlock("victoire");
                stopGame();
            }
        }
         function toggleMusic() {
            if (music.paused) {
                music.play();
                document.getElementById("musicControl").textContent = "Couper le son";
            } else {
                music.pause();
                document.getElementById("musicControl").textContent = "Activer le son";
            }
        }
        function verifierMission1() {
         
          
  if (document.getElementById("choix1").value === "B") {
                reussites++;
                collectedLetters[0] = missionLetters[0];
                document.getElementById("resultat1").innerHTML = "Correct !";
                afficherLettreGagnee(1);
                setTimeout(() => passer(2), 2000);
            } else {
                document.getElementById("resultat1").innerHTML = "Faux.";
            }
}

        function verifierMission2() {
            if (document.getElementById("reponse2").value.toLowerCase() === "gouttieres") {
                reussites++;
                collectedLetters[1] = missionLetters[1];
                document.getElementById("resultat2").innerHTML = "Correct !";
                 afficherLettreGagnee(2);
                setTimeout(() => showBlock("mission3"), 2000);
            } else {
                document.getElementById("resultat2").innerHTML = "Faux.";
            }
        }

        function jouerPendu3() {
            const lettre = document.getElementById("lettre3").value.toLowerCase();
            const display = document.getElementById("penduDisplay3");
            const resultat = document.getElementById("resultat3");
            const mot = "acheminement";
            let etat = display.textContent || "_".repeat(mot.length);
            if (lettre && resultat.textContent.includes("restants")) {
                if (mot.includes(lettre)) {
                    let nouvelEtat = "";
                    for (let i = 0; i < mot.length; i++) {
                        nouvelEtat += (mot[i] === lettre || etat[i] !== "_") ? mot[i] : "_";
                    }
                    display.textContent = nouvelEtat;
                    if (!nouvelEtat.includes("_")) {
                        reussites++;
                        collectedLetters[2] = missionLetters[2];
                        resultat.innerHTML = "Gagné ! Le mot était 'acheminement'.";
                         afficherLettreGagnee(3)
                        setTimeout(() => showBlock("mission4"), 2000);
                    }
                } else {
                    let essais = parseInt(resultat.textContent.split(": ")[1]) - 1;
                    resultat.innerHTML = `Essais restants : ${essais}`;
                    if (essais === 0) {
                        resultat.innerHTML = "Perdu ! Le mot était 'acheminement'.";
                        setTimeout(() => showBlock("mission4"), 2000);
                    }
                }
                document.getElementById("lettre3").value = "";
            }
        }

        function verifierMission4() {
            if (document.getElementById("choix4").value === "B") {
                reussites++;
                collectedLetters[3] = missionLetters[3];
                document.getElementById("resultat4").innerHTML = "Correct !";
                 afficherLettreGagnee(4)
                setTimeout(() => showBlock("mission5"), 2000);
            } else {
                document.getElementById("resultat4").innerHTML = "Faux.";
            }
        }

        function verifierMission5() {
            const match1 = document.getElementById("match5_1").value;
            const match2 = document.getElementById("match5_2").value;
            if (match1 === "B" && match2 === "A") {
                reussites++;
                collectedLetters[4] = missionLetters[4];
                document.getElementById("resultat5").innerHTML = "Correct !";
                 afficherLettreGagnee(5)
                setTimeout(() => showBlock("mission6"), 2000);
            } else {
                document.getElementById("resultat5").innerHTML = "Faux.";
            }
        }

        function verifierMission6() {
            if (document.getElementById("reponse6").value.toLowerCase() === "filtres") {
                reussites++;
                collectedLetters[5] = missionLetters[5];
                document.getElementById("resultat6").innerHTML = "Correct !";
                 afficherLettreGagnee(6)
                setTimeout(() => showBlock("mission7"), 2000);
            } else {
                document.getElementById("resultat6").innerHTML = "Faux.";
            }
        }

        function jouerPendu7() {
            const lettre = document.getElementById("lettre7").value.toLowerCase();
            const display = document.getElementById("penduDisplay7");
            const resultat = document.getElementById("resultat7");
            const mot = "durable";
            let etat = display.textContent || "_".repeat(mot.length);
            if (lettre && resultat.textContent.includes("restants")) {
                if (mot.includes(lettre)) {
                    let nouvelEtat = "";
                    for (let i = 0; i < mot.length; i++) {
                        nouvelEtat += (mot[i] === lettre || etat[i] !== "_") ? mot[i] : "_";
                    }
                    display.textContent = nouvelEtat;
                    if (!nouvelEtat.includes("_")) {
                        reussites++;
                        collectedLetters[6] = missionLetters[6];
                        resultat.innerHTML = "Gagné ! Le mot était 'durable'.";
                         afficherLettreGagnee(7)
                        setTimeout(() => showBlock("mission8"), 2000);
                    }
                } else {
                    let essais = parseInt(resultat.textContent.split(": ")[1]) - 1;
                    resultat.innerHTML = `Essais restants : ${essais}`;
                    if (essais === 0) {
                        resultat.innerHTML = "Perdu ! Le mot était 'durable'.";
                        setTimeout(() => showBlock("mission8"), 2000);
                    }
                }
                document.getElementById("lettre7").value = "";
            }
        }

        function verifierMission8() {
            const lettre = document.getElementById("lettre8").value.toLowerCase();
            const display = document.getElementById("penduDisplay8");
            const resultat = document.getElementById("resultat8");
            const mot = "thermostat";
            let etat = display.textContent || "_".repeat(mot.length);
            if (lettre && resultat.textContent.includes("restants")) {
                if (mot.includes(lettre)) {
                    let nouvelEtat = "";
                    for (let i = 0; i < mot.length; i++) {
                        nouvelEtat += (mot[i] === lettre || etat[i] !== "_") ? mot[i] : "_";
                    }
                    display.textContent = nouvelEtat;
                    if (!nouvelEtat.includes("_")) {
                        reussites++;
                        collectedLetters[7] = missionLetters[7];
                        resultat.innerHTML = "Gagné ! Le mot était 'thermostat'.";
                         afficherLettreGagnee(8)
                        setTimeout(() => showBlock("mission9"), 2000);
                    }
                } else {
                    let essais = parseInt(resultat.textContent.split(": ")[1]) - 1;
                    resultat.innerHTML = `Essais restants : ${essais}`;
                    if (essais === 0) {
                        resultat.innerHTML = "Perdu ! Le mot était 'thermostat'.";
                        setTimeout(() => showBlock("mission9"), 2000);
                    }
                }
                document.getElementById("lettre8").value = "";
            }
        }
 function afficherLettreGagnee(missionId) {
            const resultatElement = document.getElementById("resultat" + missionId);
                if (resultatElement) {
                 resultatElement.innerHTML += `<span class='lettre-collectee'> Lettre collectée: ${missionLetters[missionId - 1]}</span>`
              }
         }
        function verifierMission9() {
            if (document.getElementById("reponse9").value.toLowerCase() === "filtration") {
                reussites++;
                collectedLetters[8] = missionLetters[8];
                document.getElementById("resultat9").innerHTML = "Correct !";
                 afficherLettreGagnee(9)
                setTimeout(() => showBlock("mission10"), 2000);
            } else {
                document.getElementById("resultat9").innerHTML = "Faux.";
            }
        }

        function verifierMission10() {
            if (document.getElementById("choix10").value === "sable") {
                reussites++;
                collectedLetters[9] = missionLetters[9];
                document.getElementById("resultat10").innerHTML = "Correct !";
                 afficherLettreGagnee(10)
                setTimeout(() => showBlock("mission11"), 2000);
            } else {
                document.getElementById("resultat10").innerHTML = "Faux.";
            }
        }

        function jouerPendu11() {
            const lettre = document.getElementById("lettre11").value.toLowerCase();
            const display = document.getElementById("penduDisplay11");
            const resultat = document.getElementById("resultat11");
            const mot = "conception";
            let etat = display.textContent || "_".repeat(mot.length);
            if (lettre && resultat.textContent.includes("restants")) {
                if (mot.includes(lettre)) {
                    let nouvelEtat = "";
                    for (let i = 0; i < mot.length; i++) {
                        nouvelEtat += (mot[i] === lettre || etat[i] !== "_") ? mot[i] : "_";
                    }
                    display.textContent = nouvelEtat;
                    if (!nouvelEtat.includes("_")) {
                        reussites++;
                        collectedLetters[10] = missionLetters[10];
                        resultat.innerHTML = "Gagné ! Le mot était 'conception'.";
                         afficherLettreGagnee(11)
                        setTimeout(() => showBlock("mission12"), 2000);
                    }
                } else {
                    let essais = parseInt(resultat.textContent.split(": ")[1]) - 1;
                    resultat.innerHTML = `Essais restants : ${essais}`;
                    if (essais === 0) {
                        resultat.innerHTML = "Perdu ! Le mot était 'conception'.";
                        setTimeout(() => showBlock("mission12"), 2000);
                    }
                }
                document.getElementById("lettre11").value = "";
            }
        }

        function verifierMission12() {
            if (document.getElementById("choix12").value === "efficacite") {
                reussites++;
                collectedLetters[11] = missionLetters[11];
                document.getElementById("resultat12").innerHTML = "Correct !";
                 afficherLettreGagnee(12)
                setTimeout(() => showBlock("mission13"), 2000);
            } else {
                document.getElementById("resultat12").innerHTML = "Faux.";
            }
        }

        function verifierMission13() {
            const match1 = document.getElementById("match13_1").value;
            const match2 = document.getElementById("match13_2").value;
            const match3 = document.getElementById("match13_3").value;
            if (match1 === "ecologique" && match2 === "efficace" && match3 === "modulaire") {
                reussites++;
                collectedLetters[12] = missionLetters[12];
                document.getElementById("resultat13").innerHTML = "Correct !";
                 afficherLettreGagnee(13)
                setTimeout(() => showBlock("mission14"), 2000);
            } else {
                document.getElementById("resultat13").innerHTML = "Faux.";
            }
        }

        function verifierMission14() {
            if (document.getElementById("reponse14").value.toLowerCase() === "filtration") {
                reussites++;
                collectedLetters[13] = missionLetters[13];
                document.getElementById("resultat14").innerHTML = "Correct !";
                 afficherLettreGagnee(14)
                setTimeout(() => showBlock("mission15"), 2000);
            } else {
                document.getElementById("resultat14").innerHTML = "Faux.";
            }
        }

        function jouerPendu15() {
            const lettre = document.getElementById("lettre15").value.toLowerCase();
            const display = document.getElementById("penduDisplay15");
            const resultat = document.getElementById("resultat15");
            const mot = "inconveni";
            let etat = display.textContent || "_".repeat(mot.length);
            if (lettre && resultat.textContent.includes("restants")) {
                if (mot.includes(lettre)) {
                    let nouvelEtat = "";
                    for (let i = 0; i < mot.length; i++) {
                        nouvelEtat += (mot[i] === lettre || etat[i] !== "_") ? mot[i] : "_";
                    }
                    display.textContent = nouvelEtat;
                    if (!nouvelEtat.includes("_")) {
                        reussites++;
                        collectedLetters[14] = missionLetters[14];
                        resultat.innerHTML = "Gagné ! Le mot était 'inconveni'.";
                         afficherLettreGagnee(15)
                        setTimeout(() => showBlock("mission16"), 2000);
                    }
                } else {
                    let essais = parseInt(resultat.textContent.split(": ")[1]) - 1;
                    resultat.innerHTML = `Essais restants : ${essais}`;
                    if (essais === 0) {
                        resultat.innerHTML = "Perdu ! Le mot était 'inconveni'.";
                        setTimeout(() => showBlock("mission16"), 2000);
                    }
                }
                document.getElementById("lettre15").value = "";
            }
        }

        function verifierMission16() {
            if (document.getElementById("choix16").value === "tous") {
                reussites++;
                collectedLetters[15] = missionLetters[15];
                document.getElementById("resultat16").innerHTML = "Correct !";
                 afficherLettreGagnee(16)
                setTimeout(() => showBlock("mission17"), 2000);
            } else {
                document.getElementById("resultat16").innerHTML = "Faux.";
            }
        }

        function verifierMission17() {
            const match1 = document.getElementById("match17_1").value;
            const match2 = document.getElementById("match17_2").value;
            const match3 = document.getElementById("match17_3").value;
            if (match1 === "dessin" && match2 === "analyse" && match3 === "optimisation") {
                reussites++;
                collectedLetters[16] = missionLetters[16];
                document.getElementById("resultat17").innerHTML = "Correct !";
                 afficherLettreGagnee(17)
                setTimeout(() => showBlock("mission18"), 2000);
            } else {
                document.getElementById("resultat17").innerHTML = "Faux.";
            }
        }

        function verifierMission18() {
            if (document.getElementById("reponse18").value.toLowerCase() === "informatique") {
                reussites++;
                collectedLetters[17] = missionLetters[17];
                document.getElementById("resultat18").innerHTML = "Correct !";
                 afficherLettreGagnee(18)
                setTimeout(() => showBlock("mission19"), 2000);
            } else {
                document.getElementById("resultat18").innerHTML = "Faux.";
            }
        }

        function jouerPendu19() {
            const lettre = document.getElementById("lettre19").value.toLowerCase();
            const display = document.getElementById("penduDisplay19");
            const resultat = document.getElementById("resultat19");
            const mot = "solaire";
            let etat = display.textContent || "_".repeat(mot.length);
            if (lettre && resultat.textContent.includes("restants")) {
                if (mot.includes(lettre)) {
                    let nouvelEtat = "";
                    for (let i = 0; i < mot.length; i++) {
                        nouvelEtat += (mot[i] === lettre || etat[i] !== "_") ? mot[i] : "_";
                    }
                    display.textContent = nouvelEtat;
                    if (!nouvelEtat.includes("_")) {
                        reussites++;
                        collectedLetters[18] = missionLetters[18];
                        resultat.innerHTML = "Gagné ! Le mot était 'solaire'.";
                         afficherLettreGagnee(19)
                        setTimeout(() => showBlock("mission20"), 2000);
                    }
                } else {
                    let essais = parseInt(resultat.textContent.split(": ")[1]) - 1;
                    resultat.innerHTML = `Essais restants : ${essais}`;
                    if (essais === 0) {
                        resultat.innerHTML = "Perdu ! Le mot était 'solaire'.";
                        setTimeout(() => showBlock("mission20"), 2000);
                    }
                }
                document.getElementById("lettre19").value = "";
            }
        }

        function verifierMission20() {
            if (document.getElementById("choix20").value === "automatisation") {
                reussites++;
                collectedLetters[19] = missionLetters[19];
                document.getElementById("resultat20").innerHTML = "Correct !";
                 afficherLettreGagnee(20)
                setTimeout(() => showBlock("victoire"), 2000);
            } else {
                document.getElementById("resultat20").innerHTML = "Faux.";
            }
        }

        function stopGame() {
            clearInterval(timerInterval);
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = String(Math.floor(elapsed / 60)).padStart(2, "0");
            const seconds = String(elapsed % 60).padStart(2, "0");
            const score = Math.floor(reussites * 100 / 20);
            document.getElementById("agentResult").innerHTML = `${agent}, voici ton bilan :`;
            document.getElementById("timeResult").innerHTML = `Temps : ${minutes}:${seconds}`;
            document.getElementById("scoreResult").innerHTML = `Réussite : ${score}% (${reussites}/20 missions)`;
            document.getElementById("messageResult").innerHTML = score < 50 ? "Bon effort ! Continue à protéger la planète !" : score <= 80 ? "Beau travail ! Presque un expert en filtration !" : "Félicitations ! Un génie des microplastiques !";
            document.getElementById("parcoursResult").innerHTML = `Missions passées : ${passees.length > 0 ? passees.join(", ") : "Aucune"}`;
            let partialPhrase = "";
            for (let i = 0; i < missionLetters.length; i++) {
                partialPhrase += collectedLetters[i] || "_";
            }
            document.getElementById("partial-phrase").textContent = partialPhrase;
        }

        function verifierPhrase() {
            const inputPhrase = document.getElementById("phraseInput").value.toUpperCase().replace(/\s+/g, " ").trim();
            const result = document.getElementById("phraseResult");
            const magicWord = document.getElementById("magicWord");
            if (inputPhrase === finalPhrase) {
                result.innerHTML = "Félicitations, Agent ! Tu as percé le mystère des microplastiques !";
                result.style.color = "#A9A9A9";
                magicWord.style.display = "block";
                 magicWord.innerHTML = `Mot magique à me donner : <br> <span style="font-size: 48px; color: #ffff00; text-shadow: 2px 2px 4px #000000; animation: pulse 1.5s infinite;">${motSecret}</span>`;
            } else {
                result.innerHTML = "Pas tout à fait ! Réessaie.";
                result.style.color = "#808080";
                magicWord.style.display = "none";
            }
        }
    </script>
</body>
</html>