<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Escape Game : Les Pompes à Chaleur</title>
    <style>
        /* Styles Généraux */
        body {
            font-family: Arial, sans-serif;
            background: url('https://plus.unsplash.com/premium_photo-1716762544373-300c0a24f8d6?q=80&w=2340&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') no-repeat center/cover;
            color: #333; /* Gris foncé */
            text-align: center;
            padding: 20px;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Blocs de Mission */
        .block {
            display: none;
            background: rgba(144, 238, 144, 0.85); /* Vert clair */
            border: 3px solid #FF69B4; /* Rose vif */
            padding: 20px;
            max-width: 600px;
            border-radius: 10px;
            box-shadow: 0 0 15px #98FB98; /* Vert pâle */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            color: #f0f8ff;
        }

        .block.active {
            display: block;
            opacity: 1;
        }

        /* Fenêtres d'Aide */
        .course-window {
            display: none;
            background: rgba(255, 182, 193, 0.7); /* Rose */
            border: 2px solid #90EE90; /* Vert clair */
            padding: 15px;
            max-width: 300px;
            border-radius: 8px;
            position: absolute;
            color: #333; /* Gris foncé */
            font-size: 14px;
            z-index: 2;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.1s linear;
        }

        .course-window.active {
            display: block;
            opacity: 1;
        }

        h1, h2 {
            color: #FF69B4; /* Rose vif */
            text-shadow: 0 0 5px #98FB98; /* Vert pâle */
        }

        button {
            background-color: #98FB98; /* Vert pâle */
            border: none;
            padding: 10px 20px;
            color: #333; /* Gris foncé */
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            margin: 5px;
            transition: background 0.3s;
        }

        button:hover {
            background-color: #FF69B4; /* Rose vif */
        }

        input, select {
            padding: 8px;
            margin: 10px;
            border-radius: 5px;
            border: 1px solid #98FB98; /* Vert pâle */
            background: #fff;
            color: #333; /* Gris foncé */
            font-size: 14px;
        }

        .resultat {
            color: #FF69B4; /* Rose vif */
            font-weight: bold;
            margin-top: 10px;
        }

        .victory {
            animation: pulse 1s infinite;
            font-size: 28px;
            color: #FF69B4;
        }

        #timer {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 14px;
            color: #98FB98; /* Vert pâle */
        }

        #musicControl {
            position: fixed;
            top: 40px;
            right: 10px;
            z-index: 2;
        }

        .match-container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .match-item {
            width: 45%;
            margin: 5px;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <!-- Musique de fond -->
    <audio id="backgroundMusic" loop>
        <source src="https://nuage03.apps.education.fr/index.php/s/rfAms6FDNH2ojXM/download/Dancing%20with%20Demons.m4a" type="audio/mp4">
        Votre navigateur ne supporte pas l'audio.
    </audio>
    <button id="musicControl" onclick="toggleMusic()">Activer le son</button>
    <div id="timer">Temps : 00:00</div>

    <!-- Introduction -->
    <div id="intro" class="block active">
        <h1>Les Pompes à Chaleur : Chauffez Malin !</h1>
        <p>"Jeune éco-citoyen, le futur de la planète est entre tes mains ! Découvre le fonctionnement des pompes à chaleur, résous 20 défis et débloque une phrase secrète pour un monde plus vert ! Chaque bonne réponse te donne une lettre. En route !"</p>
        <input type="text" id="agentIdLeia" placeholder="Ton identifiant">
        <button onclick="startGame()">Démarrer</button>
    </div>

    <!-- Mission 1: QCM -->
    <div id="mission1" class="block">
        <h2>Mission 1 : Introduction</h2>
        <p id="m1text">"Quel est le principe de base d'une pompe à chaleur ?"</p>
        <select id="choix1">
            <option value="">Choisis...</option>
            <option value="A">Produire de l'électricité.</option>
            <option value="B">Transférer de la chaleur d'un endroit à un autre.</option>
            <option value="C">Consommer de l'électricité.</option>
        </select>
        <button onclick="verifierMission1()">Valider</button>
        <button onclick="passer(2)">Passer</button>
        <p id="resultat1" class="resultat"></p>
		<p id="lettreGagnee1" style="display: none;">Lettre gagnée : C</p>
    </div>
    <div id="course1" class="course-window">
        <p>Pense à un déménageur de chaleur...</p>
    </div>

    <!-- Mission 2: Question ouverte -->
    <div id="mission2" class="block">
        <h2>Mission 2 : Introduction</h2>
        <p id="m2text">"Quel appareil électroménager fonctionne un peu comme une pompe à chaleur ? (1 mot)"</p>
        <input type="text" id="reponse2" placeholder="Entre ta réponse">
        <button onclick="verifierMission2()">Valider</button>
        <button onclick="passer(3)">Passer</button>
        <p id="resultat2" class="resultat"></p>
		<p id="lettreGagnee2" style="display: none;">Lettre gagnée : H</p>
    </div>
    <div id="course2" class="course-window">
        <p>Il sert à garder les aliments au frais.</p>
    </div>

    <!-- Mission 3: Pendu -->
    <div id="mission3" class="block">
        <h2>Mission 3 : Avantages</h2>
        <p id="m3text">"Devine le mot : Adjectif qui qualifie la consommation d'une pompe à chaleur performante (9 lettres)"</p>
        <p id="penduDisplay3"></p>
        <input type="text" id="lettre3" maxlength="1" placeholder="Entre une lettre">
        <button onclick="jouerPendu3()">Essayer</button>
        <button onclick="passer(4)">Passer</button>
        <p id="resultat3" class="resultat">Essais restants : 6</p>
		<p id="lettreGagnee3" style="display: none;">Lettre gagnée : A</p>
    </div>
    <div id="course3" class="course-window">
        <p>Elle utilise peu d'énergie pour beaucoup de résultats.</p>
    </div>

    <!-- Mission 4: QCM -->
    <div id="mission4" class="block">
        <h2>Mission 4 : Types de PAC</h2>
        <p id="m4text">"Quel type de pompe à chaleur capte la chaleur du sol ?"</p>
        <select id="choix4">
            <option value="">Choisis...</option>
            <option value="A">Air-air</option>
            <option value="B">Air-eau</option>
            <option value="C">Géothermique</option>
        </select>
        <button onclick="verifierMission4()">Valider</button>
        <button onclick="passer(5)">Passer</button>
        <p id="resultat4" class="resultat"></p>
		<p id="lettreGagnee4" style="display: none;">Lettre gagnée : U</p>
    </div>
    <div id="course4" class="course-window">
        <p>Elle va chercher la chaleur sous nos pieds !</p>
    </div>

    <!-- Mission 5: Appariement -->
    <div id="mission5" class="block">
        <h2>Mission 5 : Types de PAC</h2>
        <p id="m5text">"Associe chaque type de pompe à chaleur à ce qu'elle chauffe:"</p>
        <div class="match-container">
            <div class="match-item">
                <p>PAC air-air</p>
                <select id="match5_1">
                    <option value="">Choisis...</option>
                    <option value="A">L'eau du circuit de chauffage</option>
                    <option value="B">L'air intérieur</option>
                </select>
            </div>
            <div class="match-item">
                <p>PAC air-eau</p>
                <select id="match5_2">
                    <option value="">Choisis...</option>
                    <option value="A">L'eau du circuit de chauffage</option>
                    <option value="B">L'air intérieur</option>
                </select>
            </div>
        </div>
        <button onclick="verifierMission5()">Valider</button>
        <button onclick="passer(6)">Passer</button>
        <p id="resultat5" class="resultat"></p>
		<p id="lettreGagnee5" style="display: none;">Lettre gagnée : F</p>
    </div>
    <div id="course5" class="course-window">
        <p>Regarde bien le deuxième mot de chaque type.</p>
    </div>

    <!-- Mission 6: Question ouverte -->
    <div id="mission6" class="block">
        <h2>Mission 6 : Cycle Thermodynamique</h2>
        <p id="m6text">"Le cycle thermodynamique se déroule en combien d'étapes principales ? (un chiffre)"</p>
        <input type="text" id="reponse6" placeholder="Entre ta réponse">
        <button onclick="verifierMission6()">Valider</button>
        <button onclick="passer(7)">Passer</button>
        <p id="resultat6" class="resultat"></p>
		<p id="lettreGagnee6" style="display: none;">Lettre gagnée : E</p>
    </div>
    <div id="course6" class="course-window">
        <p>Compte les étapes : évaporation, compression, condensation, ...</p>
    </div>

    <!-- Mission 7: QCM -->
    <div id="mission7" class="block">
        <h2>Mission 7 : Évaporation</h2>
        <p id="m7text">"Que fait le fluide frigorigène dans l'évaporateur ?"</p>
        <select id="choix7">
            <option value="">Choisis...</option>
            <option value="A">Il libère de la chaleur.</option>
            <option value="B">Il absorbe de la chaleur.</option>
            <option value="C">Il danse la macarena.</option>
        </select>
        <button onclick="verifierMission7()">Valider</button>
        <button onclick="passer(8)">Passer</button>
        <p id="resultat7" class="resultat"></p>
		<p id="lettreGagnee7" style="display: none;">Lettre gagnée : R</p>
    </div>
    <div id="course7" class="course-window">
        <p>Il se comporte comme une éponge.</p>
    </div>

    <!-- Mission 8: Pendu -->
    <div id="mission8" class="block">
        <h2>Mission 8 : Compression</h2>
        <p id="m8text">"Devine le mot : Que se passe-t-il à la température du fluide lors de la compression ? (9 lettres)"</p>
        <p id="penduDisplay8"></p>
        <input type="text" id="lettre8" maxlength="1" placeholder="Entre une lettre">
        <button onclick="jouerPendu8()">Essayer</button>
        <button onclick="passer(9)">Passer</button>
        <p id="resultat8" class="resultat">Essais restants : 6</p>
		<p id="lettreGagnee8" style="display: none;">Lettre gagnée : M</p>
    </div>
    <div id="course8" class="course-window">
        <p>C'est le contraire de refroidir...</p>
    </div>

    <!-- Mission 9: Question Ouverte -->
    <div id="mission9" class="block">
        <h2>Mission 9 : Condensation</h2>
        <p id="m9text">"Dans quel élément de la PAC, le fluide frigorigène cède sa chaleur ? (1 mot)"</p>
        <input type="text" id="reponse9" placeholder="Entre ta réponse">
        <button onclick="verifierMission9()">Valider</button>
        <button onclick="passer(10)">Passer</button>
        <p id="resultat9" class="resultat"></p>
		<p id="lettreGagnee9" style="display: none;">Lettre gagnée : A</p>
    </div>
    <div id="course9" class="course-window">
        <p>C'est là qu'il redevient liquide.</p>
    </div>

    <!-- Mission 10: QCM -->
    <div id="mission10" class="block">
        <h2>Mission 10 : Détente</h2>
        <p id="m10text">"Que se passe-t-il à la pression du fluide frigorigène lors de la détente ?"</p>
        <select id="choix10">
            <option value="">Choisis...</option>
            <option value="A">Elle augmente.</option>
            <option value="B">Elle diminue.</option>
            <option value="C">Elle reste stable.</option>
        </select>
        <button onclick="verifierMission10()">Valider</button>
        <button onclick="passer(11)">Passer</button>
        <p id="resultat10" class="resultat"></p>
		<p id="lettreGagnee10" style="display: none;">Lettre gagnée : L</p>
    </div>
    <div id="course10" class="course-window">
        <p>C'est comme ouvrir une bouteille de soda gazeux.</p>
    </div>

    <!-- Mission 11: Appariement -->
    <div id="mission11" class="block">
        <h2>Mission 11 : Cycle Thermodynamique</h2>
        <p id="m11text">"Associe chaque étape du cycle à son action :"</p>
        <div class="match-container">
            <div class="match-item">
                <p>Évaporation</p>
                <select id="match11_1">
                    <option value="">Choisis...</option>
                    <option value="A">Abaissement de la température.</option>
                    <option value="B">Augmentation de la température.</option>
                    <option value="C">Absorption de chaleur.</option>
                    <option value="D">Libération de chaleur.</option>
                </select>
            </div>
            <div class="match-item">
                <p>Compression</p>
                <select id="match11_2">
                    <option value="">Choisis...</option>
                     <option value="A">Abaissement de la température.</option>
                    <option value="B">Augmentation de la température.</option>
                    <option value="C">Absorption de chaleur.</option>
                    <option value="D">Libération de chaleur.</option>
                </select>
            </div>
            <div class="match-item">
                <p>Condensation</p>
                <select id="match11_3">
                    <option value="">Choisis...</option>
                     <option value="A">Abaissement de la température.</option>
                    <option value="B">Augmentation de la température.</option>
                    <option value="C">Absorption de chaleur.</option>
                    <option value="D">Libération de chaleur.</option>
                </select>
            </div>
            <div class="match-item">
                <p>Détente</p>
                <select id="match11_4">
                    <option value="">Choisis...</option>
                     <option value="A">Abaissement de la température.</option>
                    <option value="B">Augmentation de la température.</option>
                    <option value="C">Absorption de chaleur.</option>
                    <option value="D">Libération de chaleur.</option>
                </select>
            </div>
        </div>
        <button onclick="verifierMission11()">Valider</button>
        <button onclick="passer(12)">Passer</button>
        <p id="resultat11" class="resultat"></p>
		<p id="lettreGagnee11" style="display: none;">Lettre gagnée : I</p>
    </div>
    <div id="course11" class="course-window">
        <p>Réfléchis à ce qui se passe avec la chaleur et la pression à chaque étape.</p>
    </div>

    <!-- Mission 12: Pendu -->
    <div id="mission12" class="block">
        <h2>Mission 12 : Fluides Frigorigènes</h2>
        <p id="m12text">"Devine le mot : Comment qualifie-t-on les nouveaux fluides qui ne polluent pas ? (9 lettres)"</p>
        <p id="penduDisplay12"></p>
        <input type="text" id="lettre12" maxlength="1" placeholder="Entre une lettre">
        <button onclick="jouerPendu12()">Essayer</button>
        <button onclick="passer(13)">Passer</button>
        <p id="resultat12" class="resultat">Essais restants : 6</p>
		<p id="lettreGagnee12" style="display: none;">Lettre gagnée : N</p>
    </div>
    <div id="course12" class="course-window">
        <p>Ils respectent la planète.</p>
    </div>

    <!-- Mission 13: QCM -->
    <div id="mission13" class="block">
        <h2>Mission 13 : Impact Environnemental</h2>
        <p id="m13text">"Que faut-il privilégier pour réduire l'impact environnemental des fluides frigorigènes ?"</p>
        <select id="choix13">
            <option value="">Choisis...</option>
            <option value="A">Un fort potentiel de réchauffement global.</option>
            <option value="B">Un faible potentiel de réchauffement global.</option>
            <option value="C">Un potentiel de réchauffement global moyen.</option>
        </select>
        <button onclick="verifierMission13()">Valider</button>
        <button onclick="passer(14)">Passer</button>
        <p id="resultat13" class="resultat"></p>
		<p id="lettreGagnee13" style="display: none;">Lettre gagnée : V</p>
    </div>
    <div id="course13" class="course-window">
        <p>Il faut choisir ceux qui polluent le moins.</p>
    </div>

    <!-- Mission 14: Question Ouverte -->
    <div id="mission14" class="block">
        <h2>Mission 14 : Fabrication</h2>
        <p id="m14text">"Quel logiciel est utilisé pour la conception des PAC ? (3 lettres)"</p>
        <input type="text" id="reponse14" placeholder="Entre ta réponse">
        <button onclick="verifierMission14()">Valider</button>
        <button onclick="passer(15)">Passer</button>
        <p id="resultat14" class="resultat"></p>
		<p id="lettreGagnee14" style="display: none;">Lettre gagnée : E</p>
    </div>
    <div id="course14" class="course-window">
        <p>Ce logiciel aide les ingénieurs à dessiner.</p>
    </div>

    <!-- Mission 15: QCM -->
    <div id="mission15" class="block">
        <h2>Mission 15 : Maintenance</h2>
        <p id="m15text">"Que faut-il vérifier régulièrement sur une PAC pour éviter les fuites ?"</p>
        <select id="choix15">
            <option value="">Choisis...</option>
            <option value="A">Les pneus.</option>
            <option value="B">Les raccordements électriques et hydrauliques.</option>
            <option value="C">Le niveau d'huile moteur.</option>
        </select>
        <button onclick="verifierMission15()">Valider</button>
        <button onclick="passer(16)">Passer</button>
        <p id="resultat15" class="resultat"></p>
		<p id="lettreGagnee15" style="display: none;">Lettre gagnée : T</p>
    </div>
    <div id="course15" class="course-window">
        <p>Là où les tuyaux se connectent.</p>
    </div>

    <!-- Mission 16: Pendu -->
    <div id="mission16" class="block">
        <h2>Mission 16 : Energie</h2>
        <p id="m16text">"Devine le mot : Source de chaleur gratuite pour la PAC air-air (3 lettres)"</p>
        <p id="penduDisplay16"></p>
        <input type="text" id="lettre16" maxlength="1" placeholder="Entre une lettre">
        <button onclick="jouerPendu16()">Essayer</button>
        <button onclick="passer(17)">Passer</button>
        <p id="resultat16" class="resultat">Essais restants : 6</p>
		<p id="lettreGagnee16" style="display: none;">Lettre gagnée : .</p>
    </div>
    <div id="course16" class="course-window">
        <p>Ce qui nous entoure.</p>
    </div>

    <!-- Mission 17: Appariement -->
    <div id="mission17" class="block">
        <h2>Mission 17 : Sources de Chaleur</h2>
        <p id="m17text">"Associe chaque source de chaleur à son type de PAC :"</p>
        <div class="match-container">
            <div class="match-item">
                <p>Air extérieur</p>
                <select id="match17_1">
                    <option value="">Choisis...</option>
                    <option value="geothermique">PAC géothermique</option>
                    <option value="air">PAC air-air ou air-eau</option>
                     <option value="eau">PAC eau-eau</option>
                </select>
            </div>
            <div class="match-item">
                <p>Eau</p>
                <select id="match17_2">
                    <option value="">Choisis...</option>
                    <option value="geothermique">PAC géothermique</option>
                    <option value="air">PAC air-air ou air-eau</option>
                     <option value="eau">PAC eau-eau</option>
                </select>
            </div>
            <div class="match-item">
                <p>Sol</p>
                <select id="match17_3">
                    <option value="">Choisis...</option>
                    <option value="geothermique">PAC géothermique</option>
                    <option value="air">PAC air-air ou air-eau</option>
                     <option value="eau">PAC eau-eau</option>
                </select>
            </div>
        </div>
        <button onclick="verifierMission17()">Valider</button>
        <button onclick="passer(18)">Passer</button>
        <p id="resultat17" class="resultat"></p>
		<p id="lettreGagnee17" style="display: none;">Lettre gagnée : P</p>
    </div>
    <div id="course17" class="course-window">
        <p>Regarde bien le nom des PAC.</p>
    </div>

    <!-- Mission 18: Question Ouverte -->
    <div id="mission18" class="block">
        <h2>Mission 18 : Materiaux</h2>
        <p id="m18text">"De quoi sont fait les echangeur thermique  (2 mots)"</p>
        <input type="text" id="reponse18" placeholder="Entre ta réponse">
        <button onclick="verifierMission18()">Valider</button>
        <button onclick="passer(19)">Passer</button>
        <p id="resultat18" class="resultat"></p>
		<p id="lettreGagnee18" style="display: none;">Lettre gagnée : A</p>
    </div>
    <div id="course18" class="course-window">
        <p>des métaux qui conduisent bien la chaleur</p>
    </div>

    <!-- Mission 19: QCM -->
    <div id="mission19" class="block">
        <h2>Mission 19 : Conclusion</h2>
        <p id="m19text">"Grâce à quoi les PAC récentes réduisent-elles la consommation électrique ?"</p>
        <select id="choix19">
            <option value="">Choisis...</option>
            <option value="piles">Des piles à combustible.</option>
            <option value="panneaux">Des panneaux solaires.</option>
            <option value="conception">Une conception optimisée.</option>
        </select>
        <button onclick="verifierMission19()">Valider</button>
        <button onclick="passer(20)">Passer</button>
        <p id="resultat19" class="resultat"></p>
		<p id="lettreGagnee19" style="display: none;">Lettre gagnée : C</p>
    </div>
    <div id="course19" class="course-window">
        <p>Elles sont mieux pensées pour consommer moins.</p>
    </div>

    <!-- Mission 20: Pendu -->
    <div id="mission20" class="block">
        <h2>Mission 20 : Numérique</h2>
        <p id="m20text">"Devine le mot : Interface pour régler la température (9 lettres)"</p>
        <p id="penduDisplay20"></p>
        <input type="text" id="lettre20" maxlength="1" placeholder="Entre une lettre">
        <button onclick="jouerPendu20()">Essayer</button>
        <button onclick="passer(21)">Passer</button>
        <p id="resultat20" class="resultat">Essais restants : 6</p>
		<p id="lettreGagnee20" style="display: none;">Lettre gagnée : !</p>
    </div>
    <div id="course20" class="course-window">
        <p>Un objet qu'on accroche au mur pour contrôler le chauffage.</p>
    </div>

    <!-- Victoire -->
    <div id="victoire" class="block">
        <h1 class="victory">Mission Accomplie !</h1>
        <p id="agentResult"></p>
        <p id="timeResult"></p>
        <p id="scoreResult"></p>
        <p id="messageResult"></p>
        <p id="parcoursResult"></p>
        <p id="magicWord" style="display: none;"></p>
        <p>Phrase avec tes lettres :</p>
        <p id="partial-phrase"></p>
        <p>Complète la phrase (4 mots) :</p>
        <input type="text" id="phraseInput" placeholder="21 lettres max">
        <button onclick="verifierPhrase()">Valider la phrase</button>
        <p id="phraseResult"></p>
    </div>

    <script>
         let agent = "Jeune éco-citoyen";
        let startTime = 0;
        let timerInterval = null;
        let reussites = 0;
        let passees = [];
        let collectedLetters = new Array(20);
        const finalPhrase = "CHAUFFER MALIN AVEC UNE PAC";
        const missionLetters = finalPhrase.split("");
        let courseRotationInterval = null;
        let musicPlaying = false;
        let rotationSpeed = 0.05;
		const motSecret = "CHA-345";
		let essaisPendu = 6;
		let motsPendu = ["efficace", "echangeurs","air", "thermostat"];
        let penduDisplayIds = ["penduDisplay3", "penduDisplay8", "penduDisplay12", "penduDisplay16", "penduDisplay20"];

        /* Fonction pour démarrer le jeu */
        function startGame() {
            const idLeia = document.getElementById("agentIdLeia").value.trim();
            if (idLeia) {
                agent = `Jeune éco-citoyen - ${idLeia}`;
                document.querySelectorAll("p[id^='m']").forEach(p => {
                    p.innerHTML = p.innerHTML.replace("Jeune éco-citoyen", agent);
                });
                document.getElementById("intro").classList.remove("active"); /* Masquer l'intro */
                startTime = Date.now();
                timerInterval = setInterval(updateTimer, 1000);
                randomizeCoursePositions();
                showBlock("mission1");
                startCourseRotation(); /* Démarrer la rotation */
            } else {
                alert("Entre ton identifiant !");
            }
        }

        /* Fonction pour mettre à jour le timer */
        function updateTimer() {
            const now = Date.now();
            const elapsed = Math.floor((now - startTime) / 1000);
            const minutes = String(Math.floor(elapsed / 60)).padStart(2, "0");
            const seconds = String(elapsed % 60).padStart(2, "0");
            document.getElementById("timer").textContent = `Temps : ${minutes}:${seconds}`;
        }

        /* Fonction pour positionner aléatoirement les fenêtres d'aide */
        function randomizeCoursePositions() {
            const courseWindows = document.querySelectorAll(".course-window");
            courseWindows.forEach(course => {
                const maxX = window.innerWidth - 450;
                const maxY = window.innerHeight - 200;
                const courseX = Math.floor(Math.random() * maxX);
                const courseY = Math.floor(Math.random() * maxY);
                course.style.left = `${courseX}px`;
                course.style.top = `${courseY}px`;
                course.setAttribute('data-x', courseX); /* Stockage position initiale */
                course.setAttribute('data-y', courseY);
            });
        }

        /* Fonctions pour démarrer et arrêter la rotation des fenêtres d'aide */
        function startCourseRotation() {
            courseRotationInterval = setInterval(rotateCourseWindows, 50);
        }

        function stopCourseRotation() {
            clearInterval(courseRotationInterval);
        }

        /* Fonction pour gérer la rotation des fenêtres d'aide */
        function rotateCourseWindows() {
            const activeBlock = document.querySelector('.block.active');
            if (!activeBlock) return;

            const missionRect = activeBlock.getBoundingClientRect();
            const centerX = missionRect.left + missionRect.width / 2;
            const centerY = missionRect.top + missionRect.height / 2;

            const courseWindows = document.querySelectorAll(".course-window.active");

            courseWindows.forEach((course, index) => {
                const angle = (Date.now() / 1000) * rotationSpeed + index * 0.5; /* Ajuster la vitesse */
                const radius = Math.max(missionRect.width, missionRect.height) * 0.75;

                const x = centerX + radius * Math.cos(angle) - course.offsetWidth / 2;
                const y = centerY + radius * Math.sin(angle) - course.offsetHeight / 2;

                course.style.left = `${x}px`;
                course.style.top = `${y}px`;
            });
        }

        /* Fonction pour afficher un bloc de mission et sa fenêtre d'aide */
        function showBlock(blockId) {
            document.querySelectorAll(".block").forEach(block => block.classList.remove("active"));
            document.querySelectorAll(".course-window").forEach(course => course.classList.remove("active"));

            const newBlock = document.getElementById(blockId);
            if (newBlock) {
                newBlock.classList.add("active");
                const courseId = blockId.replace("mission", "course");
                const courseWindow = document.getElementById(courseId);
                if (courseWindow) courseWindow.classList.add("active");
            }
        }

        /* Fonction pour passer à la mission suivante */
        function passer(next) {
            passees.push(next - 1);
            stopCourseRotation();
            if (next <= 20) {
                showBlock(`mission${next}`);
                startCourseRotation();
				essaisPendu = 6;
            } else {
                showBlock("victoire");
                stopCourseRotation();
                stopGame();
            }
        }

        /* Fonction pour activer/désactiver la musique */
        function toggleMusic() {
            const audio = document.getElementById("backgroundMusic");
            const button = document.getElementById("musicControl");

            if (!musicPlaying) {
                audio.play();
                button.textContent = "Couper le son";
            } else {
                audio.pause();
                button.textContent = "Activer le son";
            }
            musicPlaying = !musicPlaying;
        }

      function verifierMission1() {
            const missionId = 1;
            if (document.getElementById("choix1").value === "B") {
                reussites++;
                collectedLetters[0] = missionLetters[0]; /* 'C' */
                document.getElementById("resultat1").innerHTML = "Correct !";
                afficherLettreGagnee(missionId);
                setTimeout(() => passer(2), 3000);
            } else {
                document.getElementById("resultat1").innerHTML = "Faux.";
            }
        }

        function verifierMission2() {
            const missionId = 2;
            const reponse = document.getElementById("reponse2").value.toLowerCase().trim();
            if (reponse === "refrigerateur") {
                reussites++;
                collectedLetters[1] = missionLetters[1]; /* 'H' */
                document.getElementById("resultat2").innerHTML = "Correct !";
                afficherLettreGagnee(missionId);
                setTimeout(() => passer(3), 3000);
            } else {
                document.getElementById("resultat2").innerHTML = "Faux.";
            }
        }

		function jouerPendu3() {
			jouerPendu(3);
		}

        function verifierMission4() {
            const missionId = 4;
            if (document.getElementById("choix4").value === "C") {
                reussites++;
                collectedLetters[3] = missionLetters[3]; /* 'U' */
                document.getElementById("resultat4").innerHTML = "Correct !";
                afficherLettreGagnee(missionId);
                setTimeout(() => passer(5), 3000);
            } else {
                document.getElementById("resultat4").innerHTML = "Faux.";
            }
        }

        function verifierMission5() {
            const missionId = 5;
            const match1 = document.getElementById("match5_1").value;
            const match2 = document.getElementById("match5_2").value;
            if (match1 === "B" && match2 === "A") {
                reussites++;
                collectedLetters[4] = missionLetters[4]; /* 'F' */
                document.getElementById("resultat5").innerHTML = "Correct !";
                afficherLettreGagnee(missionId);
                setTimeout(() => passer(6), 3000);
            } else {
                document.getElementById("resultat5").innerHTML = "Faux.";
            }
        }

        function verifierMission6() {
            const missionId = 6;
            const reponse = document.getElementById("reponse6").value.toLowerCase().trim();
            if (reponse === "4") {
                reussites++;
                collectedLetters[5] = missionLetters[5]; /* 'F' */
                document.getElementById("resultat6").innerHTML = "Correct !";
				afficherLettreGagnee(missionId);
                setTimeout(() => passer(7), 3000);
            } else {
                document.getElementById("resultat6").innerHTML = "Faux.";
            }
        }

        function verifierMission7() {
            const missionId = 7;
            if (document.getElementById("choix7").value === "B") {
                reussites++;
                collectedLetters[6] = missionLetters[6]; /* 'E' */
                document.getElementById("resultat7").innerHTML = "Correct !";
                afficherLettreGagnee(missionId);
                setTimeout(() => passer(8), 3000);
            } else {
                document.getElementById("resultat7").innerHTML = "Faux.";
            }
        }

		function jouerPendu8() {
			jouerPendu(8);
		}
        function verifierMission9() {
            const missionId = 9;
            const reponse = document.getElementById("reponse9").value.toLowerCase().trim();
            if (reponse === "condenseur") {
                reussites++;
                collectedLetters[8] = missionLetters[8]; /* 'M' */
                document.getElementById("resultat9").innerHTML = "Correct !";
                afficherLettreGagnee(missionId);
                setTimeout(() => passer(10), 3000);
            } else {
                document.getElementById("resultat9").innerHTML = "Faux.";
            }
        }

        function verifierMission10() {
            const missionId = 10;
            if (document.getElementById("choix10").value === "B") {
                reussites++;
                collectedLetters[9] = missionLetters[9]; /* 'R' */
                document.getElementById("resultat10").innerHTML = "Correct !";
				afficherLettreGagnee(missionId);
                setTimeout(() => passer(11), 3000);
            } else {
                document.getElementById("resultat10").innerHTML = "Faux.";
            }
        }

        function verifierMission11() {
            const missionId = 11;
            const match1 = document.getElementById("match11_1").value;
            const match2 = document.getElementById("match11_2").value;
			 const match3 = document.getElementById("match11_3").value;
            const match4 = document.getElementById("match11_4").value;
            if (match1 === "C" && match2 === "B" && match3 === "D"&& match4 === "A") {
                reussites++;
                collectedLetters[10] = missionLetters[10]; /* 'I' */
                document.getElementById("resultat11").innerHTML = "Correct !";
                afficherLettreGagnee(missionId);
                setTimeout(() => passer(12), 3000);
            } else {
                document.getElementById("resultat11").innerHTML = "Faux.";
            }
        }

		function jouerPendu12() {
			jouerPendu(12);
		}
        function verifierMission13() {
            const missionId = 13;
            if (document.getElementById("choix13").value === "B") {
                reussites++;
                collectedLetters[11] = missionLetters[11]; /* 'E' */
                document.getElementById("resultat13").innerHTML = "Correct !";
                afficherLettreGagnee(missionId);
                setTimeout(() => passer(14), 3000);
            } else {
                document.getElementById("resultat13").innerHTML = "Faux.";
            }
        }

        function verifierMission14() {
            const missionId = 14;
            const reponse = document.getElementById("reponse14").value.toLowerCase().trim();
            if (reponse === "cao") {
                reussites++;
                collectedLetters[12] = missionLetters[12]; /* 'C' */
                document.getElementById("resultat14").innerHTML = "Correct !";
				afficherLettreGagnee(missionId);
                setTimeout(() => passer(15), 3000);
            } else {
                document.getElementById("resultat14").innerHTML = "Faux.";
            }
        }

        function verifierMission15() {
            const missionId = 15;
            if (document.getElementById("choix15").value === "B") {
                reussites++;
                collectedLetters[13] = missionLetters[13]; /* 'P' */
                document.getElementById("resultat15").innerHTML = "Correct !";
				afficherLettreGagnee(missionId);
                setTimeout(() => passer(16), 3000);
            } else {
                document.getElementById("resultat15").innerHTML = "Faux.";
            }
        }

		function jouerPendu16() {
			jouerPendu(16);
		}

        function verifierMission17() {
            const missionId = 17;
            const match1 = document.getElementById("match17_1").value;
            const match2 = document.getElementById("match17_2").value;
			 const match3 = document.getElementById("match17_3").value;
            if (match1 === "air" && match2 === "eau" && match3 === "geothermique") {
                reussites++;
                collectedLetters[15] = missionLetters[15]; /* 'A' */
                document.getElementById("resultat17").innerHTML = "Correct !";
				afficherLettreGagnee(missionId);
                setTimeout(() => passer(18), 3000);
            } else {
                document.getElementById("resultat17").innerHTML = "Faux.";
            }
        }

        function verifierMission18() {
            const missionId = 18;
            const reponse = document.getElementById("reponse18").value.toLowerCase().trim();
            if (reponse === "cuivre aluminium") {
                reussites++;
                collectedLetters[16] = missionLetters[16]; /* 'C' */
                document.getElementById("resultat18").innerHTML = "Correct !";
                afficherLettreGagnee(missionId);
                setTimeout(() => passer(19), 3000);
            } else {
                document.getElementById("resultat18").innerHTML = "Faux.";
            }
        }

        function verifierMission19() {
            const missionId = 19;
            if (document.getElementById("choix19").value === "conception") {
                reussites++;
                collectedLetters[17] = missionLetters[17]; /* '"" */
                document.getElementById("resultat19").innerHTML = "Correct !";
                afficherLettreGagnee(missionId);
                setTimeout(() => passer(20), 3000);
            } else {
                document.getElementById("resultat19").innerHTML = "Faux.";
            }
        }

		function jouerPendu20() {
			jouerPendu(20);
		}

function jouerPendu(missionNumber) {

  let mot;

  if (missionNumber === 3) mot = motsPendu[0];

  if (missionNumber === 8) mot = motsPendu[1];

  if (missionNumber === 12) mot = motsPendu[2];

  if (missionNumber === 16) mot = motsPendu[3];


  const lettreInputId = `lettre${missionNumber}`;

  const displayId = `penduDisplay${missionNumber}`;

  const resultatId = `resultat${missionNumber}`;

  const lettreGagneeId = `lettreGagnee${missionNumber}`;


  const lettre = document.getElementById(lettreInputId).value.toLowerCase();

  const display = document.getElementById(displayId);

  const resultat = document.getElementById(resultatId);

  const lettreGagneeElement = document.getElementById(lettreGagneeId);


  let etat = display.textContent || "_".repeat(mot.length);


  if (lettre && resultat.textContent.includes("restants")) {

    if (mot.includes(lettre)) {

      let nouvelEtat = "";

      for (let i = 0; i < mot.length; i++) {

        nouvelEtat += (mot[i] === lettre || etat[i] === mot[i]) ? mot[i] : "_";

      }

      display.textContent = nouvelEtat;


      if (!nouvelEtat.includes("_")) {

        reussites++;

         let index = 0

 if (missionNumber === 3) index = 2;

 if (missionNumber === 8) index = 7;

 if (missionNumber === 16) index = 18;

 if (missionNumber === 20) index = 17;


        collectedLetters[index] = missionLetters[index];

        resultat.innerHTML = `Gagné ! Le mot était '${mot}'.`;

        afficherLettreGagnee(missionNumber);

        setTimeout(() => passer(missionNumber + 1), 3000);

      }

    } else {

      essaisPendu--;

      resultat.innerHTML = `Essais restants : ${essaisPendu}`;


      if (essaisPendu === 0) {

        resultat.innerHTML = `Perdu ! Le mot était '${mot}'.`;

         afficherLettreGagnee(missionNumber);

        setTimeout(() => passer(missionNumber + 1), 3000);

      }

    }

    document.getElementById(lettreInputId).value = "";

  }

}

 function afficherLettreGagnee(missionId) {

			const lettreGagneeId = `lettreGagnee${missionId}`;
			const lettreGagneeElement = document.getElementById(lettreGagneeId);

            if (lettreGagneeElement) {

                lettreGagneeElement.style.display = "block";
                setTimeout(() => {
                    lettreGagneeElement.style.display = "none";
                }, 2000);
            }
        }
        /* Fonction pour arrêter le jeu et afficher les résultats */
        function stopGame() {
            clearInterval(timerInterval);
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = String(Math.floor(elapsed / 60)).padStart(2, "0");
            const seconds = String(elapsed % 60).padStart(2, "0");
            const score = Math.floor(reussites * 100 / 20);
            document.getElementById("agentResult").innerHTML = `${agent}, voici ton bilan :`;
            document.getElementById("timeResult").innerHTML = `Temps : ${minutes}:${seconds}`;
            document.getElementById("scoreResult").innerHTML = `Réussite : ${score}% (${reussites}/20 missions)`;
            document.getElementById("messageResult").innerHTML = score < 50 ? "Bon effort ! Continue d'explorer !" : score <= 80 ? "Beau travail ! Presque pro !" : "Félicitations ! Un vrai champion !";
            document.getElementById("parcoursResult").innerHTML = `Missions passées : ${passees.length > 0 ? passees.join(", ") : "Aucune"}`;
            let partialPhrase = "";
            for (let i = 0; i < missionLetters.length; i++) {
                partialPhrase += collectedLetters[i] || "_";
            }
            document.getElementById("partial-phrase").textContent = partialPhrase;
        }

        /* Fonction pour vérifier la phrase secrète */
        function verifierPhrase() {
            const inputPhrase = document.getElementById("phraseInput").value.toUpperCase().replace(/\s+/g, " ").trim();
            const result = document.getElementById("phraseResult");
            const magicWord = document.getElementById("magicWord");
            if (inputPhrase === finalPhrase) {
                result.innerHTML = "Félicitations, Agent ! Tu as percé le mystère !";
                result.style.color = "#FF69B4"; /* Rose vif */
                magicWord.style.display = "block";
                magicWord.innerHTML = `Mot magique à me donner : ${motSecret}`;
            } else {
                result.innerHTML = "Pas tout à fait ! Réessaie.";
                result.style.color = "#98FB98"; /* Vert pâle */
                magicWord.style.display = "none";
            }
        }
    </script>
</body>
</html>